---
title: "Quick Start"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{semfindr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Purpose

```{r}
library(semfindr)
```

The sample data set based on a path model.

```{r}
dat <- pa_dat
head(dat)
mod <-
"
m1 ~ iv1 + iv2
dv ~ m1
"
```

Fit the model

```{r}
library(lavaan)
fit <- sem(mod, dat)
summary(fit)
```

Fit the model n times, each time with one case omitted

```{r}
fit_rerun <- lavaan_rerun(fit)
```

Can set parallel = TRUE to use parallel apply.

#fit_rerun <- lavaan_rerun(fit, parallel = TRUE)

Can supply case identification values

```{r}
case_names <- paste0("Case", 1:100)
fit_rerun <- lavaan_rerun(fit, case_id = case_names)
```

Compute standardized change in parameter estimates and generalized Cook's distance

```{r}
fit_est_chagne <- est_change(fit_rerun)
head(fit_est_chagne)
```

Can specify the parameters to be included. See ?est_change.

Compute raw change in parameter estimates

```{r}
head(est_change_raw(fit_rerun))
head(est_change_raw(fit_rerun, standardized = TRUE))
```

Compute Mahalanobis distance

```{r}
head(mahalanobis_rerun(fit_rerun))
```

Compute fit measure changes. E.g., chisq, cfi, tli, and rmsea

```{r}
head(fit_measures_change(fit_rerun,
                         fit_measures = c("chisq", "cfi", "tli", "rmasea")))
```

Request all those statistics in one call.

```{r}
influence_out <- influence_stat(fit_rerun)
head(influence_out)
```

See ?influence_stat for options.

Plot generalized Cook's distance

```{r}
gcd_plot(influence_out)
```

Can set the number of cases to label, based on the distance.

```{r}
gcd_plot(influence_out,
         largest_gcd = 3)
```

See ?gcd_plot.

Plot Mahalanobis distance

```{r}
md_plot(influence_out,
        largest_md = 3)
```

See ?md_plot.

Plot a fit measure against generalized Cook's distance

```{r}
gcd_gof_plot(influence_out,
             fit_measure = "chisq")
```

See ?gcd_gof_plot.

Plot a fit measure against Mahalanobis distance, with bubble size determined 
by generalized Cook's distance.

```{r}
gcd_gof_md_plot(influence_out,
                fit_measure = "chisq")
```

Can use circle_size to control the size of the largest bubble.

```{r}
gcd_gof_md_plot(influence_out,
                fit_measure = "chisq",
                circle_size = 10)
```

Can add cutoff lines

```{r}
gcd_gof_md_plot(influence_out,
                fit_measure = "chisq",
                circle_size = 10,
                cutoff_fit_measure = 1,
                cutoff_md = 9)
```

Other influence plot functions also have these features.
See ?influence_plot for more options.

Compute implied scores

```{r}
fit_with_means <- sem(mod, dat, meanstructure = TRUE)


fit_implied_scores <- implied_scores(fit_with_means)

head(fit_implied_scores)
psych::pairs.panels(fit_implied_scores)
```