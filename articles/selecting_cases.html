<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Selecting Cases In Rerun • semfindr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Selecting Cases In Rerun">
<meta property="og:description" content="semfindr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">semfindr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/semfindr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/selecting_cases.html">Selecting Cases In Rerun</a>
    </li>
    <li>
      <a href="../articles/user_id.html">Use Case IDs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sfcheung/semfindr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="selecting_cases_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Selecting Cases In Rerun</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sfcheung/semfindr/blob/master/vignettes/selecting_cases.Rmd"><code>vignettes/selecting_cases.Rmd</code></a></small>
      <div class="hidden name"><code>selecting_cases.Rmd</code></div>

    </div>

    
    
<p>Instead of refitting the model <em>n</em> times, once with each case removed, it is possible to use some criteria to select cases to be included in the analysis. This is useful when the speed to fit the model is slow and/or the sample size is very large.</p>
<p>The sample data set <code>pa_dat</code> will be used for illustration:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sfcheung.github.io/semfindr">semfindr</a></span><span class="op">)</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">pa_dat</span>
<span class="co"># Add case id</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"case"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="va">dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="co">#&gt;      id          m1         dv        iv1         iv2</span>
<span class="co">#&gt; 1 case1  0.32067106  1.4587148  0.2055776 -0.42187811</span>
<span class="co">#&gt; 2 case2  0.15360231 -0.3809220  0.1853543  0.15229953</span>
<span class="co">#&gt; 3 case3  0.35136439 -0.4886773  0.9151424  1.16670950</span>
<span class="co">#&gt; 4 case4 -0.56529330 -0.9766142  0.2884440  0.04563409</span>
<span class="co">#&gt; 5 case5 -1.60657017 -1.0948066 -0.5756171 -0.18184854</span>
<span class="co">#&gt; 6 case6  0.03143301  0.5859886  0.1420111  0.06286986</span></code></pre></div>
<p>The following model is fitted to the data set:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be">lavaan</a></span><span class="op">)</span>
<span class="co">#&gt; This is lavaan 0.6-9</span>
<span class="co">#&gt; lavaan is FREE software! Please report any bugs.</span>
<span class="va">mod</span> <span class="op">&lt;-</span> 
<span class="st">"
iv1 ~~ iv2
m1 ~ iv1 + iv2
dv ~ m1
"</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html">sem</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">dat</span><span class="op">)</span></code></pre></div>
<div id="row-numbers-or-case-ids" class="section level1">
<h1 class="hasAnchor">
<a href="#row-numbers-or-case-ids" class="anchor"></a>Row Numbers or Case IDs</h1>
<p>Suppose, for some reasons, users want to refit a model only with selected rows removed. For example, only rows 1, 4, 15, and 18 should be selected. This can be done using the argument <code>to_rerun</code> of <code><a href="../reference/lavaan_rerun.html">semfindr::lavaan_rerun()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rerun_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lavaan_rerun.html">lavaan_rerun</a></span><span class="op">(</span><span class="va">fit</span>,
                          to_rerun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">15</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; The expected CPU time is 0.44 second(s).</span>
<span class="co">#&gt; Could be faster if ran in parallel.</span></code></pre></div>
<p>Only four reruns in the output:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rerun_out</span>
<span class="co">#&gt; === lavaan_rerun Output ===</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lavaan_rerun(fit = fit, to_rerun = c(1, 4, 15, 18))</span>
<span class="co">#&gt; Number of reruns: 4</span>
<span class="co">#&gt; Number of reruns that passed post.check of lavaan: 4</span>
<span class="co">#&gt; Number of reruns that failed post.check of lavaan: 0</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/est_change.html">est_change</a></span><span class="op">(</span><span class="va">rerun_out</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;    iv1~~iv2 m1~iv1 m1~iv2  dv~m1 m1~~m1 dv~~dv iv1~~iv1 iv2~~iv2   gcd</span>
<span class="co">#&gt; 1    -0.013  0.024 -0.030  0.052 -0.037  0.017   -0.061   -0.056 0.013</span>
<span class="co">#&gt; 4     0.006 -0.024 -0.003  0.022 -0.051 -0.044   -0.056   -0.070 0.014</span>
<span class="co">#&gt; 15    0.008  0.001  0.003 -0.009 -0.070 -0.061   -0.070   -0.058 0.017</span>
<span class="co">#&gt; 18   -0.023 -0.273  0.035  0.101  0.260 -0.046    0.043   -0.067 0.163</span></code></pre></div>
<p>If user supplied case IDs are used, then the value of <code>to_rerun</code> should be a vector of these case IDs:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rerun_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lavaan_rerun.html">lavaan_rerun</a></span><span class="op">(</span><span class="va">fit</span>,
                          case_id <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">id</span>,
                          to_rerun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"case1"</span>,
                                       <span class="st">"case4"</span>,
                                       <span class="st">"case15"</span>,
                                       <span class="st">"case18"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; The expected CPU time is 0.44 second(s).</span>
<span class="co">#&gt; Could be faster if ran in parallel.</span></code></pre></div>
<p>Only four reruns in the output. User supplied case IDs are used in the output:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rerun_out</span>
<span class="co">#&gt; === lavaan_rerun Output ===</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lavaan_rerun(fit = fit, case_id = dat$id, to_rerun = c("case1", </span>
<span class="co">#&gt;     "case4", "case15", "case18"))</span>
<span class="co">#&gt; Number of reruns: 4</span>
<span class="co">#&gt; Number of reruns that passed post.check of lavaan: 4</span>
<span class="co">#&gt; Number of reruns that failed post.check of lavaan: 0</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/est_change.html">est_change</a></span><span class="op">(</span><span class="va">rerun_out</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;        iv1~~iv2 m1~iv1 m1~iv2  dv~m1 m1~~m1 dv~~dv iv1~~iv1 iv2~~iv2   gcd</span>
<span class="co">#&gt; case1    -0.013  0.024 -0.030  0.052 -0.037  0.017   -0.061   -0.056 0.013</span>
<span class="co">#&gt; case4     0.006 -0.024 -0.003  0.022 -0.051 -0.044   -0.056   -0.070 0.014</span>
<span class="co">#&gt; case15    0.008  0.001  0.003 -0.009 -0.070 -0.061   -0.070   -0.058 0.017</span>
<span class="co">#&gt; case18   -0.023 -0.273  0.035  0.101  0.260 -0.046    0.043   -0.067 0.163</span></code></pre></div>
</div>
<div id="mahalanobis-distance-on-residuals" class="section level1">
<h1 class="hasAnchor">
<a href="#mahalanobis-distance-on-residuals" class="anchor"></a>Mahalanobis Distance on Residuals</h1>
<p>Users can select cases using their rankings on the Mahalanobis distance computed using the regression-based residuals. This is possible only for models with observed variables only (i.e., path models). This is analogous to selecting cases based on their residuals in a multiple regression model. A path model can have more than one endogenous variables. The residuals of a case on all endogenous variables will be computed, and the Mahalanobis distance will be computed using these residuals.</p>
<p>This is done using the argument <code>resid_md_top</code>. Users specify the top <em>x</em> cases on this distance to be selected for refitting a model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rerun_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lavaan_rerun.html">lavaan_rerun</a></span><span class="op">(</span><span class="va">fit</span>,
                          case_id <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">id</span>,
                          resid_md_top <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; The expected CPU time is 0.55 second(s).</span>
<span class="co">#&gt; Could be faster if ran in parallel.</span></code></pre></div>
<p>Five cases were selected, as shown below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rerun_out</span>
<span class="co">#&gt; === lavaan_rerun Output ===</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lavaan_rerun(fit = fit, case_id = dat$id, resid_md_top = 5)</span>
<span class="co">#&gt; Number of reruns: 5</span>
<span class="co">#&gt; Number of reruns that passed post.check of lavaan: 5</span>
<span class="co">#&gt; Number of reruns that failed post.check of lavaan: 0</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/est_change.html">est_change</a></span><span class="op">(</span><span class="va">rerun_out</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;        iv1~~iv2 m1~iv1 m1~iv2  dv~m1 m1~~m1 dv~~dv iv1~~iv1 iv2~~iv2   gcd</span>
<span class="co">#&gt; case16   -0.019  0.052 -0.038 -0.237 -0.004  0.624   -0.049   -0.059 0.456</span>
<span class="co">#&gt; case43    0.236 -0.403 -0.263 -0.135  0.223  0.120    0.195    0.030 0.407</span>
<span class="co">#&gt; case61    0.004 -0.007 -0.021 -0.153  0.350 -0.031   -0.070   -0.070 0.157</span>
<span class="co">#&gt; case85   -0.066 -0.174  0.216 -0.119  0.335 -0.052   -0.031   -0.011 0.214</span>
<span class="co">#&gt; case65    0.133  0.152  0.191  0.363  0.076  0.161    0.000    0.046 0.241</span></code></pre></div>
<p>Note that selecting cases by this method <em>can</em> miss some influential cases. As in multiple regression, a case that is influential on the results needs not be a case that is poorly predicted by the exogenous variables. Therefore, this method should be used with caution.</p>
</div>
<div id="mahalanobis-distance-on-all-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#mahalanobis-distance-on-all-variables" class="anchor"></a>Mahalanobis Distance on All Variables</h1>
<p>Users can select cases using their rankings on the Mahalanobis distance computed using all observed variables. This is done using the argument <code>md_top</code>. Users specify the top <em>x</em> cases on this distance to be selected for refitting a model.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rerun_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lavaan_rerun.html">lavaan_rerun</a></span><span class="op">(</span><span class="va">fit</span>,
                          case_id <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">id</span>,
                          md_top <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; The expected CPU time is 0.55 second(s).</span>
<span class="co">#&gt; Could be faster if ran in parallel.</span></code></pre></div>
<p>Five cases were selected, as shown below:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rerun_out</span>
<span class="co">#&gt; === lavaan_rerun Output ===</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lavaan_rerun(fit = fit, case_id = dat$id, md_top = 5)</span>
<span class="co">#&gt; Number of reruns: 5</span>
<span class="co">#&gt; Number of reruns that passed post.check of lavaan: 5</span>
<span class="co">#&gt; Number of reruns that failed post.check of lavaan: 0</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/est_change.html">est_change</a></span><span class="op">(</span><span class="va">rerun_out</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;        iv1~~iv2 m1~iv1 m1~iv2  dv~m1 m1~~m1 dv~~dv iv1~~iv1 iv2~~iv2   gcd</span>
<span class="co">#&gt; case16   -0.019  0.052 -0.038 -0.237 -0.004  0.624   -0.049   -0.059 0.456</span>
<span class="co">#&gt; case99    0.163  0.002  0.009  0.187 -0.070  0.033   -0.054    0.686 0.559</span>
<span class="co">#&gt; case87   -0.419 -0.011  0.019  0.101 -0.070  0.000    0.096    0.457 0.413</span>
<span class="co">#&gt; case43    0.236 -0.403 -0.263 -0.135  0.223  0.120    0.195    0.030 0.407</span>
<span class="co">#&gt; case51   -0.130  0.421 -0.057  0.094  0.089 -0.044    0.525   -0.056 0.492</span></code></pre></div>
<p>Note that selecting cases by this method <em>can</em> miss some influential cases (Pek &amp; MacCallum, 2011). Unlike multiple regression, this distance is not a measure of leverage. For a path model, this distance used distances from the centroid on <em>all</em> observed variables, including exogenous variables and endogenous variables. For a model with latent factors, this distance is affected by both residuals and values predicted by the latent factors. Therefore, this method should be used with caution.</p>
</div>
<div id="final-remarks" class="section level1">
<h1 class="hasAnchor">
<a href="#final-remarks" class="anchor"></a>Final Remarks</h1>
<p>If feasible, it is recommended to refit a model once for each case, such that the influential of all cases can be considered together. The methods above are included when the processing time is slow and so only selected cases are to be explored. For the final model(s), <code><a href="../reference/lavaan_rerun.html">semfindr::lavaan_rerun()</a></code> using all cases are recommended, to serve as a final check on the sensitivity of the results to individual cases.</p>
</div>
<div id="reference" class="section level1">
<h1 class="hasAnchor">
<a href="#reference" class="anchor"></a>Reference</h1>
<p>Pek, J., &amp; MacCallum, R. (2011). Sensitivity analysis in structural equation models: Cases and their influence. <em>Multivariate Behavioral Research, 46</em>(2), 202–228. <a href="https://doi.org/10.1080/00273171.2011.561068" class="uri">https://doi.org/10.1080/00273171.2011.561068</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Shu Fai Cheung.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
